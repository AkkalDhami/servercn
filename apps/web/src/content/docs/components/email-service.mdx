---
title: Email Service
description: Production-ready email service for sending emails in ServerCN using nodemailer with support for multiple providers (Gmail, SMTP, SendGrid, etc.).
command: npx servercn add email-service

mvc_structure:
  - type: folder
    name: src
    children:
      - type: folder
        name: configs
        children:
          - type: file
            name: env.ts
            content: |
              interface Config {
                PORT: number;
                NODE_ENV: string;
                LOG_LEVEL: string;

                SMTP_HOST: string;
                SMTP_PORT: number;
                SMTP_USER: string;
                SMTP_PASS: string;
                EMAIL_FROM: string;

                //? For Resend Email Service Only
                RESEND_API_KEY: string;
              }

              const env: Config = {
                PORT: Number(process.env.PORT) || 3000,
                NODE_ENV: process.env.NODE_ENV || 'development',
                LOG_LEVEL: process.env.LOG_LEVEL || 'info',
                
                SMTP_HOST: process.env.SMTP_HOST!,
                SMTP_PORT: Number(process.env.SMTP_PORT) || 587,
                SMTP_USER: process.env.SMTP_USER!,
                SMTP_PASS: process.env.SMTP_PASS!,
                EMAIL_FROM: process.env.EMAIL_FROM!,

                RESEND_API_KEY: process.env.RESEND_API_KEY!,
              };

              export default env;

          - type: file
            name: nodemailer.ts
            content: |
              import nodemailer from "nodemailer";
              import env from "./env";
              
              let transporter: nodemailer.Transporter | null = null;
              
              export function getTransporter() {
                if (transporter) return transporter;
                const host = env.SMTP_HOST;
                const port = Number(env.SMTP_PORT || 465);
                const user = env.SMTP_USER;
                const pass = env.SMTP_PASS;
                const from = env.EMAIL_FROM;
                if (!host || !user || !pass || !from) {
                  throw new Error("SMTP/EMAIL env not configured");
                }
              
                transporter = nodemailer.createTransport({
                  host,
                  port,
                  secure: port === 465,
                  auth: { user, pass }
                });
                return transporter;
              }
              

          - type: file
            name: resend.ts
            content: |
              //? For Resend Email Service Only
              //? Not required for SMTP/Gmail setup

              import { Resend } from "resend";
              import env from "./env";
              
              export const resend = new Resend(env.RESEND_API_KEY);
                  
      - type: folder
        name: utils
        children: 
          - type: file
            name: send-mail.ts
            content: |
              import env from "../configs/env";
              import { getTransporter } from "../configs/nodemailer";
              import { resend } from "../configs/resend";

              type sendMail = {
                from?: string;
                subject: string;
                data: Record<string, any>;
                email: string;
                html: string;
              };

              export async function sendEmail({
                from,
                email,
                subject,
                html
              }: sendMail) {
                const transporter = getTransporter();

                return transporter
                  .sendMail({
                    from: from || `<${env.EMAIL_FROM}>`,
                    to: email,
                    subject,
                    html
                  })
                  .catch(() => {
                    throw new Error("Failed to send email");
                  });
              }

              export async function sendEmailWithResend({
                from,
                email,
                subject,
                html
              }: sendMail) {

                return await resend.emails.send({
                    from: from || `<${env.EMAIL_FROM}>`,
                    to: email,
                    subject,
                    replyTo: email,
                    html
                  });
              }            

  - type: file
    name: .env.example
    content: |
      SMTP_HOST='smtp.gmail.com'
      SMTP_PORT='465'
      SMTP_USER=''
      SMTP_PASS=''
      EMAIL_FROM=""

      # For Resend Email Service Only
      RESEND_API_KEY="your-resend-api-key"

feature_structure:
  - type: folder
    name: src
    children:
      - type: folder
        name: shared
        children:
          - type: folder
            name: configs
            children:
              - type: file
                name: env.ts
                content: |
                  interface Config {
                    PORT: number;
                    NODE_ENV: string;
                    LOG_LEVEL: string;

                    SMTP_HOST: string;
                    SMTP_PORT: number;
                    SMTP_USER: string;
                    SMTP_PASS: string;
                    EMAIL_FROM: string;

                    //? For Resend Email Service Only
                    RESEND_API_KEY: string;
                  }

                  const env: Config = {
                    PORT: Number(process.env.PORT) || 3000,
                    NODE_ENV: process.env.NODE_ENV || 'development',
                    LOG_LEVEL: process.env.LOG_LEVEL || 'info',
                    
                    SMTP_HOST: process.env.SMTP_HOST!,
                    SMTP_PORT: Number(process.env.SMTP_PORT) || 587,
                    SMTP_USER: process.env.SMTP_USER!,
                    SMTP_PASS: process.env.SMTP_PASS!,
                    EMAIL_FROM: process.env.EMAIL_FROM!,

                    RESEND_API_KEY: process.env.RESEND_API_KEY!,
                  };

                  export default env;

              - type: file
                name: nodemailer.ts
                content: |
                  import nodemailer from "nodemailer";
                  import env from "./env";
                  
                  let transporter: nodemailer.Transporter | null = null;
                  
                  export function getTransporter() {
                    if (transporter) return transporter;
                    const host = env.SMTP_HOST;
                    const port = Number(env.SMTP_PORT || 465);
                    const user = env.SMTP_USER;
                    const pass = env.SMTP_PASS;
                    const from = env.EMAIL_FROM;
                    if (!host || !user || !pass || !from) {
                      throw new Error("SMTP/EMAIL env not configured");
                    }
                  
                    transporter = nodemailer.createTransport({
                      host,
                      port,
                      secure: port === 465,
                      auth: { user, pass }
                    });
                    return transporter;
                  }
                  

              - type: file
                name: resend.ts
                content: |
                  //? For Resend Email Service Only
                  //? Not required for SMTP/Gmail setup

                  import { Resend } from "resend";
                  import env from "./env";
                  
                  export const resend = new Resend(env.RESEND_API_KEY);
                      
          - type: folder
            name: utils
            children: 
              - type: file
                name: send-mail.ts
                content: |
                  import env from "../configs/env";
                  import { getTransporter } from "../configs/nodemailer";
                  import { resend } from "../configs/resend";

                  type sendMail = {
                    from?: string;
                    subject: string;
                    data: Record<string, any>;
                    email: string;
                    html: string;
                  };

                  export async function sendEmail({
                    from,
                    email,
                    subject,
                    html
                  }: sendMail) {
                    const transporter = getTransporter();

                    return transporter
                      .sendMail({
                        from: from || `<${env.EMAIL_FROM}>`,
                        to: email,
                        subject,
                        html
                      })
                      .catch(() => {
                        throw new Error("Failed to send email");
                      });
                  }

                  export async function sendEmailWithResend({
                    from,
                    email,
                    subject,
                    html
                  }: sendMail) {

                    return await resend.emails.send({
                        from: from || `<${env.EMAIL_FROM}>`,
                        to: email,
                        subject,
                        replyTo: email,
                        html
                      });
                  }            

  - type: file
    name: .env.example
    content: |
      SMTP_HOST='smtp.gmail.com'
      SMTP_PORT='465'
      SMTP_USER=''
      SMTP_PASS=''
      EMAIL_FROM=""

      # For Resend Email Service Only
      RESEND_API_KEY="your-resend-api-key"
---

# Email Service

The **Email Service** component provides a production-ready solution for sending emails in ServerCN using **nodemailer**. It supports multiple email providers including Gmail, SMTP servers, SendGrid, and more.

## Features

- **Multiple email providers** - Gmail, SMTP, SendGrid, AWS SES, and more
- **HTML and plain text emails** - Support for both HTML and text content
- **Attachments** - Send files as email attachments
- **Multiple recipients** - Support for CC, BCC, and multiple recipients
- **Type-safe** - Full TypeScript support
- **Error handling** - Comprehensive error handling and validation
- **Email verification** - Verify email configuration before sending

## Installation Guide

Install this component using the following command:

<PackageManagerTabs command="npx servercn add email-service" />

## Prerequisites

### Gmail Setup (Recommended for Development)

1. Enable **2-Step Verification** on your Google Account
2. Generate an **App Password**:
   - Go to Google Account → Security → 2-Step Verification → App passwords
   - Create a new app password for "Mail"
   - Copy the generated password

### Environment Variables

Add the following to your <Code children=".env" /> file:

**SMTP Server**

```bash
SMTP_HOST='smtp.gmail.com'
SMTP_PORT='465'
SMTP_USER=''
SMTP_PASS=''
EMAIL_FROM=""
```

**Resend**

```bash
RESEND_API_KEY="your-resend-api-key"
```

## Basic Implementation

### 1. NodeMailer Implementation

**MVC Path:** <Code children="src/configs/nodemailer.ts" />

**Feature Path:** <Code children="src/shared/configs/nodemailer.ts" />

```ts
import nodemailer from "nodemailer";
import env from "./env";

let transporter: nodemailer.Transporter | null = null;

export function getTransporter() {
  if (transporter) return transporter;
  const host = env.SMTP_HOST;
  const port = Number(env.SMTP_PORT || 465);
  const user = env.SMTP_USER;
  const pass = env.SMTP_PASS;
  const from = env.EMAIL_FROM;
  if (!host || !user || !pass || !from) {
    throw new Error("SMTP/EMAIL env not configured");
  }

  transporter = nodemailer.createTransport({
    host,
    port,
    secure: port === 465,
    auth: { user, pass }
  });
  return transporter;
}
```

### 2. Resend Implementation

**MVC Path:** <Code children="src/configs/resend.ts" />

**Feature Path:** <Code children="src/shared/configs/resend.ts" />

```ts
import { Resend } from "resend";
import env from "./env";

export const resend = new Resend(env.RESEND_API_KEY);
```

### 3. Send Email Function

**MVC Path:** <Code children="src/utils/send-mail.ts" />

**Feature Path:** <Code children="src/shared/utils/send-mail.ts" />

```ts
import env from "../configs/env";
import { getTransporter } from "../configs/nodemailer";
import { ApiError } from "./api-error";
import { resend } from "../configs/resend";

type sendMail = {
  from?: string;
  subject: string;
  data: Record<string, any>;
  email: string;
  html: string;
};

export async function sendEmail({
  from,
  email,
  subject,
  html
}: sendMail) {
  const transporter = getTransporter();

  return transporter
    .sendMail({
      from: from || `<${env.EMAIL_FROM}>`,
      to: email,
      subject,
      html
    })
    .catch(() => {
      throw ApiError.badRequest("Failed to send email");
    });
}

export async function sendEmailWithResend({
  from,
  email,
  subject,
  html
}: sendMail) {

  return await resend.emails.send({
      from: from || `<${env.EMAIL_FROM}>`,
      to: email,
      subject,
      replyTo: email,
      html
    });
}
```

## Usage Examples

### 1. Send HTML Email

```ts
import { sendEmail } from "../utils/send-mail";

const html = `
  <h1>Welcome to ServerCN</h1>
  <p>Thank you for joining us!</p>
`;

await sendEmail({
  email: "john.doe@example.com",
  subject: "Welcome to ServerCN",
  html
});
```

### 2. Send Email with Resend

```ts
import { sendEmailWithResend } from "../utils/send-mail";
const html = `
  <h1>Reset Your Password</h1>
  <p>Click <a href="https://example.com/reset">here</a> to reset your password.</p>
`;

await sendEmailWithResend({
  email: "john.doe@example.com",
  subject: "Reset Your Password",
  html,
  from: "ServerCN <servercn@example.com>"
});
```


## Best Practices

1. **Use environment variables** - Never hardcode email credentials
2. **Validate email addresses** - Validate recipient emails before sending
3. **Handle errors gracefully** - Implement proper error handling and logging
4. **Use HTML templates** - Use template engines for consistent email design
5. **Rate limiting** - Implement rate limiting for email endpoints
6. **Email queuing** - Use job queues (Bull, BullMQ) for bulk emails
7. **Test emails** - Use services like Mailtrap for testing in development

## Security Considerations

1. **App Passwords** - Use app-specific passwords for Gmail
2. **Environment Variables** - Store credentials securely
3. **Rate Limiting** - Prevent email spam and abuse
4. **Input Validation** - Validate email addresses and content
5. **HTTPS** - Use secure connections (EMAIL_SECURE=true for port 465)
