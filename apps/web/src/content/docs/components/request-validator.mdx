---
title: Request Validator (Zod)
description: The Request Validator component provides a standardized way to validate request data in ServerCN using **Zod** schemas.
command: npx servercn add request-validator

mvc_structure:
  - type: folder
    name: src
    children:
      - type: folder
        name: constants
        children:
          - type: file
            name: status-codes.ts
            content: |
              export const STATUS_CODES = {
                // 2xx Success
                OK: 200,
                CREATED: 201,
                ACCEPTED: 202,
                NO_CONTENT: 204,

                // 3xx Redirection
                MOVED_PERMANENTLY: 301,
                FOUND: 302,
                NOT_MODIFIED: 304,

                // 4xx Client Errors
                BAD_REQUEST: 400,
                UNAUTHORIZED: 401,
                FORBIDDEN: 403,
                NOT_FOUND: 404,
                CONFLICT: 409,
                UNPROCESSABLE_ENTITY: 422,
                TOO_MANY_REQUESTS: 429,

                // 5xx Server Errors
                INTERNAL_SERVER_ERROR: 500,
                NOT_IMPLEMENTED: 501,
                BAD_GATEWAY: 502,
                SERVICE_UNAVAILABLE: 503,
                GATEWAY_TIMEOUT: 504,
              } as const;

              export type StatusCode = (typeof STATUS_CODES)[keyof typeof STATUS_CODES];

      - type: folder
        name: middlewares
        children:
          - type: file
            name: validate-request.ts
            content: |
              import { Request, Response, NextFunction } from "express";
              import z, { ZodError, type ZodObject } from "zod";

              import { ApiError } from "../utils/api-error";

              export const validateRequest = (schema: ZodObject<any>) => {
                return (req: Request, res: Response, next: NextFunction) => {
                  try {
                    schema.parse(req.body);

                    next();
                  } catch (error) {
                    if (!(error instanceof ZodError)) {
                      return next(error);
                    }

                    throw ApiError.badRequest(
                      "Invalid request data",
                      z.flattenError(error).fieldErrors || z.flattenError(error)
                    );
                  }
                };
              };

      - type: folder
        name: utils
        children:
          - type: file
            name: api-error.ts
            content: |
              import { STATUS_CODES, StatusCode } from "../constants/status-codes";

              export class ApiError extends Error {
              public readonly statusCode: StatusCode;
              public readonly isOperational: boolean;
              public readonly errors?: unknown;

              constructor(
                  statusCode: StatusCode,
                  message: string,
                  errors?: unknown,
                  isOperational = true
              ) {
                  super(message);
                  this.name = "ApiError";
                  this.statusCode = statusCode;
                  this.errors = errors;
                  this.isOperational = isOperational;

                  Error.captureStackTrace(this, this.constructor);
              }

              static badRequest(message = "Bad Request", errors?: unknown) {
                  return new ApiError(STATUS_CODES.BAD_REQUEST, message, errors);
              }

              static unauthorized(message = "Unauthorized") {
                  return new ApiError(STATUS_CODES.UNAUTHORIZED, message);
              }

              static forbidden(message = "Forbidden") {
                  return new ApiError(STATUS_CODES.FORBIDDEN, message);
              }

              static notFound(message = "Not Found") {
                  return new ApiError(STATUS_CODES.NOT_FOUND, message);
              }

              static conflict(message = "Conflict") {
                  return new ApiError(STATUS_CODES.CONFLICT, message);
              }

              static server(message = "Internal Server Error") {
                  return new ApiError(STATUS_CODES.INTERNAL_SERVER_ERROR, message);
              }
              }

              /*
              ? Usage:
              * throw new ApiError(STATUS_CODES.NOT_FOUND, "Not found");
              * throw ApiError.badRequest("Bad request");
              */

      - type: folder
        name: validations
        children:
          - type: file
            name: user.validation.ts
            content: |
              import { z } from "zod";

              export const createUserSchema = z.object({
                name: z.string().min(2, "Name must be at least 2 characters"),
                email: z.email("Invalid email address"),
                password: z.string().min(8, "Password must be at least 8 characters"),
                age: z.number().int().min(18).max(100).optional(),
              });

      - type: folder
        name: routes
        children:
          - type: file
            name: user.routes.ts
            content: |
              import { Router } from "express";
              import { validateRequest } from "../middlewares/validate-request";
              import { createUserSchema } from "../validations/user.validation";
              import { STATUS_CODES } from "../constants/status-codes";

              const router = Router();

              router.post("/", validateRequest(createUserSchema), (req, res) => {
                return res.status(STATUS_CODES.CREATED).json({
                  success: true,
                  message: "User created successfully",
                  data: req.body,
                });
              });

              export default router;

      - type: file
        name: app.ts
        content: |
          import express, { type Application } from "express";
          import UserRouter from "./routes/user.routes";

          const app: Application = express();

          app.use(express.json());

          // routes here
          app.use("/api/v1/users", UserRouter);

          export default app;

feature_structure:
  - type: folder
    name: src
    children:
      - type: folder
        name: shared
        children:
          - type: folder
            name: constants
            children:
              - type: file
                name: status-codes.ts
                content: |
                  export const STATUS_CODES = {
                    // 2xx Success
                    OK: 200,
                    CREATED: 201,
                    ACCEPTED: 202,
                    NO_CONTENT: 204,

                    // 3xx Redirection
                    MOVED_PERMANENTLY: 301,
                    FOUND: 302,
                    NOT_MODIFIED: 304,

                    // 4xx Client Errors
                    BAD_REQUEST: 400,
                    UNAUTHORIZED: 401,
                    FORBIDDEN: 403,
                    NOT_FOUND: 404,
                    CONFLICT: 409,
                    UNPROCESSABLE_ENTITY: 422,
                    TOO_MANY_REQUESTS: 429,

                    // 5xx Server Errors
                    INTERNAL_SERVER_ERROR: 500,
                    NOT_IMPLEMENTED: 501,
                    BAD_GATEWAY: 502,
                    SERVICE_UNAVAILABLE: 503,
                    GATEWAY_TIMEOUT: 504,
                  } as const;

                  export type StatusCode = (typeof STATUS_CODES)[keyof typeof STATUS_CODES];

          - type: folder
            name: errors
            children:
              - type: file
                name: api-error.ts
                content: |
                  import { STATUS_CODES, StatusCode } from "../constants/status-codes";

                  export class ApiError extends Error {
                  public readonly statusCode: StatusCode;
                  public readonly isOperational: boolean;
                  public readonly errors?: unknown;

                  constructor(
                      statusCode: StatusCode,
                      message: string,
                      errors?: unknown,
                      isOperational = true
                  ) {
                      super(message);
                      this.name = "ApiError";
                      this.statusCode = statusCode;
                      this.errors = errors;
                      this.isOperational = isOperational;

                      Error.captureStackTrace(this, this.constructor);
                  }

                  static badRequest(message = "Bad Request", errors?: unknown) {
                      return new ApiError(STATUS_CODES.BAD_REQUEST, message, errors);
                  }

                  static unauthorized(message = "Unauthorized") {
                      return new ApiError(STATUS_CODES.UNAUTHORIZED, message);
                  }

                  static forbidden(message = "Forbidden") {
                      return new ApiError(STATUS_CODES.FORBIDDEN, message);
                  }

                  static notFound(message = "Not Found") {
                      return new ApiError(STATUS_CODES.NOT_FOUND, message);
                  }

                  static conflict(message = "Conflict") {
                      return new ApiError(STATUS_CODES.CONFLICT, message);
                  }

                  static server(message = "Internal Server Error") {
                      return new ApiError(STATUS_CODES.INTERNAL_SERVER_ERROR, message);
                  }
                  }

                  /*
                  ? Usage:
                  * throw new ApiError(STATUS_CODES.NOT_FOUND, "Not found");
                  * throw ApiError.badRequest("Bad request");
                  */

          - type: folder
            name: middlewares
            children:
              - type: file
                name: validate-request.ts
                content: |
                  import { Request, Response, NextFunction } from "express";
                  import z, { ZodError, type ZodObject } from "zod";

                  import { ApiError } from "../errors/api-error";

                  export const validateRequest = (schema: ZodObject<any>) => {
                    return (req: Request, res: Response, next: NextFunction) => {
                      try {
                        schema.parse(req.body);

                        next();
                      } catch (error) {
                        if (!(error instanceof ZodError)) {
                          return next(error);
                        }

                        throw ApiError.badRequest(
                          "Invalid request data",
                          z.flattenError(error).fieldErrors || z.flattenError(error)
                        );
                      }
                    };
                  };

      - type: folder
        name: modules
        children:
          - type: folder
            name: user
            children:
              - type: file
                name: user.validation.ts
                content: |
                  import { z } from "zod";

                  export const createUserSchema = z.object({
                      name: z.string().min(2, "Name must be at least 2 characters"),
                      email: z.email("Invalid email address"),
                      password: z.string().min(8, "Password must be at least 8 characters"),
                      age: z.number().int().min(18).max(100).optional(),
                  });

              - type: file
                name: user.routes.ts
                content: |
                  import { Router } from "express";
                  import { validateRequest } from "../../shared/middlewares/validate-request";
                  import { createUserSchema } from "./user.validation";
                  import { STATUS_CODES } from "../../shared/constants/status-codes";

                  const router = Router();

                  router.post("/", validateRequest(createUserSchema), (req, res) => {
                      return res.status(STATUS_CODES.CREATED).json({
                        success: true,
                        message: "User created successfully",
                        data: req.body,
                      });
                  });

                  export default router;

      - type: folder
        name: routes
        children:
          - type: file
            name: index.ts
            content: |
              import { Router } from "express";
              import UserRouter from "../modules/user/user.routes";

              const router = Router();

              router.use("/v1/users", UserRouter);

              export default router;

      - type: file
        name: app.ts
        content: |
          import express, { type Application } from "express";
          import Routes from "./routes/index";

          const app: Application = express();

          app.use(express.json());

          // routes here
          app.use("/api", Routes);


          export default app;
---

# Request Validator (Zod)

The **Request Validator** component provides a standardized way to validate request data (body, query parameters, and route parameters) in ServerCN using **Zod** schemas.

It automatically:

- Validates request body, query, and params using Zod schemas
- Returns detailed validation error messages
- Integrates seamlessly with ServerCN error handling
- Provides type-safe request data after validation

This middleware is designed for **type-safe, schema-based validation** in REST APIs.

## Installation Guide

This component requires additional ServerCN components.

**_üëâ Note:_** _You do not need to install any dependencies manually. Installing this component will automatically install all required dependencies. Manual installation is optional if you prefer to manage dependencies yourself._

### 1. Install ServerCN dependencies(Optional)

- **HTTP Status Codes:**

<PackageManagerTabs command="npx servercn add http-status-codes" />

Documentation: [HTTP Status Codes](/docs/components/http-status-codes)

- **API Error Handler:**

<PackageManagerTabs command="npx servercn add error-handler" />

Documentation: [API Error Handler](/docs/components/error-handler)

### 2. Install this component

<PackageManagerTabs command="npx servercn add request-validator" />

> ‚ö†Ô∏è If these dependencies are not installed, the component will not function correctly.

## How Validation Works

The Request Validator middleware follows this sequence:

1. **Schema Definition**: Define Zod schemas for body, query, or params
2. **Middleware Application**: Apply <Code children="validateRequest" /> middleware to routes
3. **Validation**: Middleware validates incoming request data against schemas
4. **Error Handling**: If validation fails, returns detailed error messages
5. **Type Safety**: Validated data is typed and attached to the request object

This ensures **type-safe request handling** with clear validation error messages.

## Middleware Implementation

### 1. MVC Structure

<Code children="src/middlewares/validate-request.ts" />

```ts
import { Request, Response, NextFunction } from "express";
import z, { ZodError, type ZodObject } from "zod";

import { ApiError } from "../utils/api-error";

export const validateRequest = (schema: ZodObject<any>) => {
  return (req: Request, res: Response, next: NextFunction) => {
    try {
      schema.parse(req.body);

      next();
    } catch (error) {
      if (!(error instanceof ZodError)) {
        return next(error);
      }

      throw ApiError.badRequest("Invalid request data", z.flattenError(error).fieldErrors || z.flattenError(error));
    }
  };
};
```

### 2. Feature Structure

<Code children="src/shared/middlewares/validate-request.ts" />

```ts
import { Request, Response, NextFunction } from "express";
import z, { ZodError, type ZodObject } from "zod";

import { ApiError } from "../utils/api-error";

export const validateRequest = (schema: ZodObject<any>) => {
  return (req: Request, res: Response, next: NextFunction) => {
    try {
      schema.parse(req.body);

      next();
    } catch (error) {
      if (!(error instanceof ZodError)) {
        return next(error);
      }

      throw ApiError.badRequest("Invalid request data", z.flattenError(error).fieldErrors || z.flattenError(error));
    }
  };
};
```

## Schema Definition

Create validation schemas using Zod.

### 1. MVC Structure

<Code children="src/validations/user.validation.ts" />

```ts
import z from "zod";

export const createUserSchema = z.object({
  name: z.string().min(2, "Name must be at least 2 characters"),
  email: z.string().email("Invalid email address"),
  password: z.string().min(8, "Password must be at least 8 characters"),
  age: z.number().int().min(18).max(100).optional()
});
```

### 2. Feature Structure

<Code children="src/modules/user/user.validation.ts" />

```ts
import z from "zod";

export const createUserSchema = z.object({
  name: z.string().min(2, "Name must be at least 2 characters"),
  email: z.string().email("Invalid email address"),
  password: z.string().min(8, "Password must be at least 8 characters"),
  age: z.number().int().min(18).max(100).optional()
});
```

## Usage Example

Apply the <Code children="validateRequest" /> middleware to your routes with the appropriate schema.

### 1. MVC Structure

<Code children="src/routes/user.routes.ts" />

```ts
import { Router } from "express";
import { validateRequest } from "../middlewares/validate-request";
import { createUserSchema } from "./user.validation";

const router = Router();

router.post("/", validateRequest(createUserSchema), (req, res) => {
  return res.status(201).json({ success: true, data: req.body });
});

export default router;
```

### 2. Feature Structure

<Code children="src/modules/user/user.routes.ts" />

```ts
import { Router } from "express";
import { validateRequest } from "../../shared/middlewares/validate-request";
import { createUserSchema } from "./user.validation";

const router = Router();

router.post("/", validateRequest(createUserSchema), (req, res) => {
  return res.status(201).json({ success: true, data: req.body });
});

export default router;
```

## Validation Error Responses

When validation fails, the handler returns a standardized 400 Bad Request response with detailed error information:

```json
{
  "success": false,
  "message": "Invalid request data",
  "statusCode": 400,
  "errors": {
    "email": ["Invalid email address"],
    "password": ["Password must be at least 8 characters"],
    "age": ["You must be 18 or older to create an account"]
  }
}
```

(The exact structure depends on your <Code children='ApiError' /> implementation.)

## Best Practices

- **Separate Schemas**: Create separate validation files for each resource/module
- **Reusable Schemas**: Extract common validation patterns into shared schemas
- **Clear Error Messages**: Provide descriptive error messages in your Zod schemas
- **Type Safety**: Use Zod's type inference for TypeScript type safety
- **Transform Data**: Use Zod's transform methods to convert query strings to numbers, dates, etc.
- **Validate Early**: Apply validation middleware before business logic
- **Consistent Structure**: Keep validation schemas organized and consistent across your application
