{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ServerCN Registry Schema",
  "description": "Validates ServerCN registry:schema entries (runtime → framework → database → orm → module → architecture).",
  "type": "object",

  "required": ["slug", "runtimes", "dependencies"],
  "additionalProperties": false,

  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri"
    },

    "slug": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique kebab-case schema identifier"
    },

    "runtimes": {
      "type": "object",
      "required": ["node"],
      "additionalProperties": false,

      "properties": {
        "node": { "$ref": "#/$defs/nodeRuntime" }
      }
    },

    "dependencies": {
      "type": "object",
      "description": "Dependency sets keyed by capability (stack, db, orm)",
      "additionalProperties": {
        "$ref": "#/$defs/dependencySet"
      }
    }
  },

  "$defs": {
    "nodeRuntime": {
      "type": "object",
      "required": ["frameworks"],
      "additionalProperties": false,

      "properties": {
        "frameworks": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/$defs/framework"
          }
        }
      }
    },

    "framework": {
      "type": "object",
      "required": ["databases"],
      "additionalProperties": false,

      "properties": {
        "databases": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/$defs/database"
          }
        }
      }
    },

    "database": {
      "type": "object",
      "required": ["orms"],
      "additionalProperties": false,

      "properties": {
        "orms": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/$defs/orm"
          }
        }
      }
    },

    "orm": {
      "type": "object",
      "required": ["templates"],
      "additionalProperties": false,

      "properties": {
        "templates": {
          "type": "object",
          "minProperties": 1,
          "description": "Module-based templates (index, otp, user, etc.)",
          "additionalProperties": {
            "$ref": "#/$defs/moduleTemplate"
          },
          "patternProperties": {
            "^[a-z0-9-]+$": {
              "$ref": "#/$defs/moduleTemplate"
            }
          }
        }
      }
    },

    "moduleTemplate": {
      "type": "object",
      "additionalProperties": false,

      "properties": {
        "mvc": {
          "type": "string",
          "description": "MVC architecture template path"
        },
        "feature": {
          "type": "string",
          "description": "Feature-based architecture template path"
        }
      },

      "minProperties": 1
    },

    "dependencySet": {
      "type": "object",
      "additionalProperties": false,

      "properties": {
        "runtime": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dev": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
