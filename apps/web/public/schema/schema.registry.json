{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ServerCN Registry Schema",
  "description": "Validates ServerCN registry schema (runtime → framework → database → orm → module → architecture).",
  "type": "object",

  "required": ["slug", "runtimes"],
  "additionalProperties": false,

  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri",
      "description": "Schema reference URL"
    },

    "slug": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique kebab-case schema identifier"
    },

    "runtimes": {
      "type": "object",
      "description": "Runtime configurations",
      "required": ["node"],
      "additionalProperties": false,
      "properties": {
        "node": {
          "$ref": "#/$defs/nodeRuntime"
        }
      }
    }
  },

  "$defs": {
    "nodeRuntime": {
      "type": "object",
      "description": "Node.js runtime configuration",
      "required": ["frameworks"],
      "additionalProperties": false,
      "properties": {
        "frameworks": {
          "type": "object",
          "description": "Supported frameworks",
          "required": ["express"],
          "additionalProperties": false,
          "properties": {
            "express": {
              "$ref": "#/$defs/framework"
            }
          }
        }
      }
    },

    "framework": {
      "type": "object",
      "description": "Framework configuration",
      "required": ["databases"],
      "additionalProperties": false,
      "properties": {
        "databases": {
          "type": "object",
          "description": "Supported databases",
          "additionalProperties": false,
          "properties": {
            "mongodb": {
              "$ref": "#/$defs/mongodbDatabase"
            },
            "mysql": {
              "$ref": "#/$defs/sqlDatabase"
            },
            "postgresql": {
              "$ref": "#/$defs/sqlDatabase"
            }
          }
        }
      }
    },

    "mongodbDatabase": {
      "type": "object",
      "description": "MongoDB database configuration (Mongoose only)",
      "required": ["orms"],
      "additionalProperties": false,
      "properties": {
        "orms": {
          "type": "object",
          "required": ["mongoose"],
          "additionalProperties": false,
          "properties": {
            "mongoose": {
              "$ref": "#/$defs/orm"
            }
          }
        }
      }
    },

    "sqlDatabase": {
      "type": "object",
      "description": "SQL database configuration (Drizzle only)",
      "required": ["orms"],
      "additionalProperties": false,
      "properties": {
        "orms": {
          "type": "object",
          "required": ["drizzle"],
          "additionalProperties": false,
          "properties": {
            "drizzle": {
              "$ref": "#/$defs/orm"
            }
          }
        }
      }
    },

    "orm": {
      "type": "object",
      "description": "ORM configuration including templates and dependencies",
      "required": ["templates", "dependencies"],
      "additionalProperties": false,
      "properties": {
        "templates": {
          "type": "object",
          "description": "Module-based templates (index, todo, user, etc.)",
          "minProperties": 1,
          "patternProperties": {
            "^[a-z0-9-]+$": {
              "$ref": "#/$defs/moduleTemplate"
            }
          },
          "additionalProperties": false
        },

        "dependencies": {
          "$ref": "#/$defs/dependencySet"
        }
      }
    },

    "moduleTemplate": {
      "type": "object",
      "description": "Architecture-based template paths",
      "additionalProperties": false,
      "properties": {
        "mvc": {
          "type": "string",
          "description": "MVC architecture template path"
        },
        "feature": {
          "type": "string",
          "description": "Feature-based architecture template path"
        }
      },
      "minProperties": 1
    },

    "dependencySet": {
      "type": "object",
      "description": "Dependency definitions for an ORM",
      "additionalProperties": false,
      "properties": {
        "runtime": {
          "type": "array",
          "description": "Runtime dependencies",
          "items": { "type": "string" }
        },
        "dev": {
          "type": "array",
          "description": "Development dependencies",
          "items": { "type": "string" }
        }
      }
    }
  }
}
