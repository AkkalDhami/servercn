{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ServerCN Registry Component Schema",
  "description": "Defines the structure for a ServerCN registry component. A component can either be variant-based (with user prompts) or simple (direct templates).",
  "type": "object",

  "required": ["slug", "$schema", "type"],
  "additionalProperties": false,

  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri",
      "description": "URI reference to the JSON Schema definition"
    },

    "type": {
      "type": "string",
      "enum": ["component", "foundation", "blueprint", "tooling", "schema"],
      "description": "Type of the component, determining its role in the registry"
    },

    "slug": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "title": "Component Slug",
      "description": "Unique, URL-safe identifier for the component (kebab-case)"
    },

    "prompt": {
      "type": "object",
      "title": "CLI Prompt Configuration",
      "description": "Defines how the CLI should prompt the user to select a component variant",
      "required": ["type", "message", "key"],
      "properties": {
        "type": {
          "const": "select",
          "description": "Prompt type (currently only select is supported)"
        },
        "message": {
          "type": "string",
          "description": "Message shown to the user in the CLI"
        },
        "key": {
          "type": "string",
          "description": "Key used to store the selected option"
        }
      },
      "additionalProperties": false
    },

    "variants": {
      "type": "object",
      "title": "Component Variants",
      "description": "List of selectable implementations for this component",
      "additionalProperties": {
        "type": "object",
        "required": ["label", "templates"],
        "additionalProperties": false,

        "properties": {
          "label": {
            "type": "string",
            "description": "Human-readable label shown in the CLI"
          },

          "templates": {
            "type": "object",
            "title": "Framework Templates",
            "description": "Templates organized by framework and architecture",
            "additionalProperties": false,

            "properties": {
              "express": { "$ref": "#/$defs/frameworkTemplates" },
              "nest": { "$ref": "#/$defs/frameworkTemplates" }
            },

            "anyOf": [{ "required": ["express"] }, { "required": ["nest"] }]
          },

          "dependencies": {
            "type": "object",
            "title": "Dependencies",
            "description": "Dependencies required for this variant",
            "additionalProperties": false,
            "properties": {
              "runtime": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Runtime dependencies"
              },
              "dev": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Development-only dependencies"
              }
            }
          },

          "env": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Environment variables required by this variant"
          }
        }
      }
    },

    "templates": {
      "type": "object",
      "title": "Direct Templates",
      "description": "Templates for simple components without variants",
      "additionalProperties": false,

      "properties": {
        "express": { "$ref": "#/$defs/frameworkTemplates" },
        "nest": { "$ref": "#/$defs/frameworkTemplates" }
      },

      "anyOf": [{ "required": ["express"] }, { "required": ["nest"] }]
    },

    "dependencies": {
      "type": "object",
      "title": "Component Dependencies",
      "description": "Dependencies required for a simple component",
      "additionalProperties": false,
      "properties": {
        "runtime": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dev": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  },

  "oneOf": [
    {
      "title": "Variant-based Component",
      "description": "Component that requires user selection via CLI prompt",
      "required": ["prompt", "variants"],
      "not": {
        "required": ["templates"]
      }
    },
    {
      "title": "Simple Component",
      "description": "Component with direct templates and no variants",
      "required": ["templates"],
      "not": {
        "anyOf": [{ "required": ["prompt"] }, { "required": ["variants"] }]
      }
    }
  ],

  "$defs": {
    "frameworkTemplates": {
      "type": "object",
      "description": "Architecture-specific template paths for a framework",
      "additionalProperties": false,
      "properties": {
        "mvc": {
          "type": "string",
          "description": "MVC architecture template path"
        },
        "feature": {
          "type": "string",
          "description": "Feature-based architecture template path"
        }
      }
    }
  }
}
